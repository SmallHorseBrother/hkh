# NutriLens 项目总结文档

## 1. 项目简介
**NutriLens (AI 智能膳食分析)** 是一个基于 Next.js 和 Google Gemini AI 的现代化 Web 应用。它利用先进的图像识别技术，将用户的手机变成一台“智能食物秤”，帮助用户精准、便捷地记录和分析每日饮食的营养摄入。

## 2. 技术架构 (Technical Architecture)
- **核心框架**: Next.js 15+ (App Router) + React 19 + TypeScript
- **AI 引擎**: Google Generative AI (Gemini 3 Flash/Pro Preview)
- **身份验证**: Supabase Auth (支持邮箱密码登录/注册，实现多用户隔离)
- **数据安全**: 开启 Row Level Security (RLS)，确保用户仅能访问属于自己的数据
- **样式方案**: Tailwind CSS 4.0
- **后端支持**: Next.js Route Handlers + Supabase Cloud
- **存储方案**: 
    - **云端数据库 (Supabase PostgreSQL)**: 结构化存储识餐记录、食物项、常餐模版及偏差样本，所有表均包含 `user_id`。
    - **对象存储 (Supabase Storage)**: 存储高清食物图片，仅登录用户上传，支持基于 RLS 的删除权限。
    - **本地内存/localStorage**: 未登录状态下的临时存储与备份方案。

## 3. 核心功能 (Core Features)
- **可选登录流程 (Guest & User Modes)**:
    - **游客模式**: 无需登录即可拍照识别，查看即时营养分析，数据仅保存在本地内存。
    - **会员模式**: 登录后数据自动同步云端，永久保存历史记录、常餐模版和偏差样本。
- **智能识餐与纠偏**:
    - 支持 **快速版 (Flash)** 和 **精细版 (Pro)** 双模型切换。
    - **全局/单品调节**: 支持总重缩放、单品微调（±10%）及进食比例调节。
- **数据管理系统**:
    - **常餐模版 (Staple Meals)**: 高频餐食保存为模版，实现图片与数据的秒级复用。
    - **偏差归档系统 (Critical Samples)**: 标记 AI 估算有误的样本，用于后续模型优化。
- **营养洞察看板**: 
    - 可视化展示四大核心营养素及 AI 实时健康建议。

## 4. 当前现状
项目已完成用户体系集成与数据隔离升级：
1. **身份验证落地**: 成功接入 Supabase Auth，实现了可选登录逻辑。
2. **多租户隔离**: 数据库表结构增加了 `user_id` 字段，并配置了完备的 RLS 策略。
3. **Storage 权限优化**: `food-images` 存储桶已配置 RLS，支持用户对个人图片的增删管理。
4. **ID 类型标准化**: 统一使用 UUID 作为数据库主键，解决了前端临时 ID 与后端类型的匹配问题。

下一步计划：
- **深度分析**: 增加基于时间轴的长期营养摄入趋势图表。
- **数据迁移**: 研究实现游客模式数据在登录后的一键迁移功能。
- **移动端优化**: 适配 PWA 或开发原生应用外壳以提升拍摄体验。
